<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>פסוק אישי לפי שם - כל התנ"ך</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre:wght@700&family=Assistant:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* --- General Styling --- */
        :root {
            --primary-color: #0D2B45; /* כחול עמוק */
            --secondary-color: #205375; /* כחול ביניים */
            --accent-color: #c09f80; /* זהב/ברונזה עדין */
            --background-color: #f8f6f2; /* רקע אוף-ווייט חם */
            --text-color: #333D45; /* אפור-כחול כהה לטקסט */
            --light-bg: #FFFFFF; /* לבן */
            --result-bg: #fffaf0; /* קרם בהיר לתוצאה */
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            line-height: 1.7;
            background-image: url('https://www.transparenttextures.com/patterns/light-paper-fibers.png');
        }

        /* --- Container --- */
        .container {
            width: 100%;
            max-width: 750px;
            background-color: var(--light-bg);
            padding: 40px 50px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-top: 5px solid var(--primary-color);
        }

        /* --- Typography --- */
        h1 {
            font-family: 'Frank Ruhl Libre', serif;
            color: var(--primary-color);
            font-size: 2.8em;
            margin-bottom: 15px;
        }

        .explanation {
            max-width: 600px;
            margin: 0 auto 30px auto;
            font-size: 1.1em;
            color: #555;
        }

        strong {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        hr {
            border: none;
            border-top: 1px solid #e0e6ed;
            margin: 20px 0;
        }

        /* --- Search Area --- */
        .search-area {
            margin-top: 30px;
            padding: 30px;
            background-color: #f7f9fc;
            border: 1px solid #e0e6ed;
            border-radius: 8px;
        }

        label {
            font-size: 1.25em;
            font-weight: 600;
            color: var(--secondary-color);
        }

        input[type="text"] {
            width: 70%;
            padding: 12px 15px;
            margin-top: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1.2em;
            text-align: right;
            font-family: 'Assistant', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(192, 159, 128, 0.2);
        }

        button {
            display: block;
            width: 50%;
            margin: 20px auto 0 auto;
            padding: 14px 28px;
            font-size: 1.2em;
            font-weight: 600;
            color: var(--light-bg);
            background-color: var(--accent-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        button:hover:not(:disabled) {
            background-color: #a88a6d; /* גוון כהה יותר של הצבע */
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }

        /* --- Result Area --- */
        #result {
            margin-top: 35px;
            padding: 25px;
            background-color: var(--result-bg);
            border: 1px solid #e9e0d3;
            border-radius: 8px;
            min-height: 60px;
            font-size: 1.2em;
            line-height: 1.8;
            color: var(--text-color);
            text-align: right;
        }
        
        #result.fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        .result-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9e0d3;
        }
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .result-verse {
            font-weight: 600;
            font-size: 1.2em; 
            color: var(--text-color);
        }

        .reference {
            font-size: 1rem;
            color: var(--secondary-color);
            margin-top: 10px;
            font-weight: 400;
        }

        .search-mode-info {
            font-style: italic;
            font-size: 0.9rem;
            color: #777;
            margin-top: 5px;
        }
        /* --- Responsive Design for Mobile Phones --- */
        @media (max-width: 600px) {
            body {
                padding: 10px; 
            }

            .container {
                padding: 25px 15px; 
                margin: 0;
            }

            h1 {
                font-size: 2.1em; 
            }

            .explanation {
                font-size: 1em; 
            }

            .search-area {
                padding: 20px;
            }

            input[type="text"] {
                width: 90%; 
            }

            button {
                width: 80%; 
                padding: 12px 20px;
            }

            #result {
                font-size: 1em; 
                padding: 20px;
            }
            .result-verse {
                font-size: 1.1em;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>פסוק אישי לפי שם</h1>
        <div class="explanation">
            <p><strong>סגולה שלא ישכח שמו ליום הדין:</strong> יאמר קודם "יהיו לרצון" השני בתפילת העמידה, פסוק מהתנ"ך המתחיל באות הראשונה של שמו ומסתיים באות האחרונה של שמו. הכלי יציג את כל הפסוקים התואמים מכל התנ"ך.</p>
        </div>
        <div class="search-area">
            <label for="nameInput">הכניסו שם ולחצו לחיפוש הפסוק</label><br>
            <input type="text" id="nameInput" placeholder="לדוגמא: נתנאל">
            <br>
            <button id="searchButton" onclick="findVerse()">מצא את הפסוק שלי</button>
        </div>
        <div id="result">
            <p id="status">טוען את כל התנ"ך מ-Sefaria, אנא המתן בסבלנות...</p>
        </div>
    </div>

    <script>
        // --- Global Variables ---
        let allTanakhVerses = [];

        // --- DOM Elements ---
        const searchButton = document.getElementById('searchButton');
        const nameInput = document.getElementById('nameInput');
        const resultDiv = document.getElementById('result');
        const statusP = document.getElementById('status');
        
        searchButton.disabled = true;

        // --- Tanakh Structure Definition ---
        const tanakhStructure = {
            'Torah': {'Genesis': 50, 'Exodus': 40, 'Leviticus': 27, 'Numbers': 36, 'Deuteronomy': 34},
            'Neviim': {'Joshua': 24, 'Judges': 21, 'I Samuel': 31, 'II Samuel': 24, 'I Kings': 22, 'II Kings': 25, 'Isaiah': 66, 'Jeremiah': 52, 'Ezekiel': 48, 'Hosea': 14, 'Joel': 4, 'Amos': 9, 'Obadiah': 1, 'Jonah': 4, 'Micah': 7, 'Nahum': 3, 'Habakkuk': 3, 'Zephaniah': 3, 'Haggai': 2, 'Zechariah': 14, 'Malachi': 3},
            'Ketuvim': {'Psalms': 150, 'Proverbs': 31, 'Job': 42, 'Song of Songs': 8, 'Ruth': 4, 'Lamentations': 5, 'Ecclesiastes': 12, 'Esther': 10, 'Daniel': 12, 'Ezra': 10, 'Nehemiah': 13, 'I Chronicles': 29, 'II Chronicles': 36}
        };

        // --- Data Loading Functions ---
        async function loadBooks(bookList) {
            let chapterRequests = [];
            for (const book in bookList) {
                for (let i = 1; i <= bookList[book]; i++) {
                    chapterRequests.push(fetch(`https://www.sefaria.org/api/texts/${book}.${i}`));
                }
            }
            const responses = await Promise.all(chapterRequests);
            const chapterDataPromises = responses.map(res => res.json());
            const allChapterData = await Promise.all(chapterDataPromises);
            
            let verses = [];
            allChapterData.forEach(chapterInfo => {
                if (!chapterInfo.heRef || !Array.isArray(chapterInfo.he)) return;
                const hebrewReference = chapterInfo.heRef;
                const versesInChapter = chapterInfo.he;
                versesInChapter.forEach((verseText, verseIndex) => {
                    verses.push({ text: verseText, reference: `${hebrewReference}, ${String.fromCharCode(1488 + verseIndex)}׳` });
                });
            });
            return verses;
        }

        async function loadInitialData() {
            try {
                const allBooks = { ...tanakhStructure.Torah, ...tanakhStructure.Neviim, ...tanakhStructure.Ketuvim };
                allTanakhVerses = await loadBooks(allBooks);
                statusP.textContent = `המאגר נטען (${allTanakhVerses.length.toLocaleString()} פסוקים). ניתן לחפש.`;
                searchButton.disabled = false;
            } catch (error) {
                console.error('Sefaria API Error:', error);
                statusP.textContent = 'שגיאת רשת. אנא בדוק את חיבור האינטרנט ורענן.';
                statusP.style.color = 'red';
            }
        }

        // --- Main Search Logic ---
        async function findVerse() {
            searchButton.disabled = true; // Disable button during search
            const name = nameInput.value.trim();
            if (name.length < 2) {
                resultDiv.innerHTML = '<p>אנא הכנס שם בעל שתי אותיות לפחות.</p>';
                searchButton.disabled = false;
                return;
            }

            // Perform ONLY the letter-based search across the entire Tanakh
            const finalResults = findMatchesByLetters(name, allTanakhVerses);
            
            // Add searchMode property for consistency in display
            finalResults.forEach(m => m.searchMode = "אות ראשונה ואחרונה");
            
            // Display all found results
            displayAllResults(finalResults, name);

            searchButton.disabled = false;
        }
        
        // --- Search Helper Functions ---
        function findMatchesByLetters(name, verseList) {
            const firstLetter = name[0];
            const lastLetter = name[name.length - 1];
            // Handles final-form letters (ך, ם, ן, ף, ץ) by normalizing them
            const getNormalizedLetter = (letter) => ({'ך':'כ','ם':'מ','ן':'נ','ף':'פ','ץ':'צ'})[letter] || letter;
            const normalizedLastLetter = getNormalizedLetter(lastLetter);

            return verseList.filter(item => {
                // Clean the verse text from any HTML tags and punctuation for accurate matching
                const text = item.text.replace(/<[^>]*>/g, '').replace(/[.,?!;׃]/g, ''); 
                const words = text.split(' ').filter(w => w); // Split into words and remove empty entries
                if (words.length < 1) return false;
                
                const verseFirstLetter = words[0][0];
                const lastWord = words[words.length - 1];
                const verseLastLetter = lastWord.slice(-1);
                
                // Compare the first letter directly, and the normalized last letter
                return verseFirstLetter === firstLetter && getNormalizedLetter(verseLastLetter) === normalizedLastLetter;
            });
        }

        // --- Display Helper Function ---
        function displayAllResults(matches, name) {
            resultDiv.classList.remove('fade-in');
            void resultDiv.offsetWidth; // Trigger reflow to restart animation

            if (matches.length === 0) {
                resultDiv.innerHTML = `<p>לא נמצא פסוק המתחיל באות '<strong>${name[0]}</strong>' ומסתיים באות '<strong>${name[name.length-1]}</strong>' עבור השם '<strong>${name}</strong>'.</p>`;
                resultDiv.classList.add('fade-in');
                return;
            }

            let html = `<p><strong>נמצאו ${matches.length} פסוקים תואמים עבור '${name}':</strong></p><hr>`;
            
            matches.forEach(verse => {
                html += `
                    <div class="result-item">
                        <p class="result-verse">${verse.text.replace(/<[^>]*>/g, '')}</p>
                        <div class="reference">
                            ${verse.reference}
                            <div class="search-mode-info">שיטת חיפוש: ${verse.searchMode}</div>
                        </div>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = html;
            resultDiv.classList.add('fade-in');
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', loadInitialData);
        nameInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !searchButton.disabled) {
                event.preventDefault();
                findVerse();
            }
        });
    </script>
</body>
</html>
